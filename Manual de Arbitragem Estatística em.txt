Manual de Arbitragem Estatística em Derivativos Meteorológicos: Uma Abordagem Quantitativa para Mercados de Previsão
1. Introdução: A Transição do Forecasting para a Precificação Probabilística
A emergência de mercados de previsão descentralizados, notadamente o Polymarket, inaugurou uma nova classe de ativos financeiros: os derivativos binários de eventos meteorológicos de alta frequência. Diferentemente dos futuros climáticos tradicionais (como os contratos de Heating Degree Days da CME), que servem principalmente para hedge corporativo de longo prazo e liquidam mensalmente, os contratos do Polymarket oferecem granularidade diária e liquidação baseada em extremos de temperatura em estações de monitoramento específicas. Este relatório estabelece um framework quantitativo rigoroso para a extração de alpha nestes mercados, alterando o paradigma operacional de "prever o tempo" para "precificar distribuições de probabilidade".
A tese central desta estratégia reside na ineficiência estrutural do mercado. O "livro de ofertas" (Order Book) do Polymarket é composto majoritariamente por participantes de varejo e traders heurísticos que, sistematicamente, falham em precificar corretamente a variância ($\sigma^2$) e a curtose das distribuições de temperatura. Enquanto o consenso de mercado frequentemente converge para a média determinística da previsão ($\mu$), ele negligencia a massa de probabilidade nas "caudas" e a incerteza intrínseca do modelo. Ao tratar a temperatura não como uma estimativa pontual, mas como uma variável estocástica $T \sim \mathcal{N}(\mu, \sigma)$, o operador quantitativo pode construir uma Função de Densidade de Probabilidade (PDF) que identifica intervalos mal precificados.
O objetivo não é superar os supercomputadores do ECMWF ou do NCEP na física atmosférica. O objetivo é atuar como um market maker inteligente, provendo liquidez onde os preços divergem das probabilidades estatisticamente derivadas. A operação não busca o acerto binário (Hit/Miss), mas a maximização do Valor Esperado (EV) agregado através de milhares de micro-operações, fundamentadas na Lei dos Grandes Números.
Este documento detalha a arquitetura de um motor de precificação que sintetiza três disciplinas:
    1. Ciência Atmosférica Computacional: Utilização de sistemas de previsão por ensemble (EPS) para derivar intervalos de confiança.
    2. Arbitragem Estatística: Aplicação da Função de Distribuição Acumulada (CDF) para precificar contratos binários específicos.
    3. Teoria Moderna de Portfólio: Implementação do Critério de Kelly Generalizado para eventos mutuamente exclusivos via Gradient Ascent, otimizando o tamanho das posições em múltiplos contratos simultâneos (Dutching).

2. Ontologia de Mercado e Microestrutura dos Derivativos Binários
Para operar matematicamente, é imperativo desconstruir o instrumento financeiro. Os contratos meteorológicos do Polymarket são opções binárias totalmente colateralizadas (títulos Arrow-Debreu) que pagam $1,00 se o evento ocorrer e $0,00 caso contrário. Portanto, o preço $P$ de um contrato é estritamente igual à probabilidade implícita $\pi$ que o mercado atribui àquele evento, acrescida de um prêmio de risco e spread de liquidez.
2.1 A Invariante Fundamental e a Oportunidade de Arbitragem
Em um mercado de "Temperatura Máxima" para uma cidade e data específicas, o espaço de resultados é particionado em bins (intervalos) mutuamente exclusivos. Por exemplo, para Nova York (NYC), o mercado pode oferecer:
    • Contrato A: $\le 30^\circ\text{F}$
    • Contrato B: $31-32^\circ\text{F}$
    • Contrato C: $33-34^\circ\text{F}$
    • ...
    • Contrato Z: $\ge 50^\circ\text{F}$
A invariante fundamental que governa este sistema fechado é:
$$\sum_{i=A}^{Z} P_i \approx 1.0$$
Em um mercado eficiente, a soma dos preços de todos os contratos possíveis deveria igualar $1,00. No entanto, devido à dinâmica do CLOB (Central Limit Order Book) e à ineficiência dos participantes, frequentemente observamos:
    1. Over-round (Soma > 1.0): A soma das melhores ofertas de venda (ask) excede $1,00, indicando que o mercado está "caro" como um todo (imposto sobre o tomador de liquidez).
    2. Under-round (Soma < 1.0): A soma das ofertas de compra (bid) é inferior a $1,00.
    3. Arbitragem Estrutural: Ocasionalmente, a soma dos asks pode cair abaixo de $1,00 em momentos de pânico ou reajuste rápido de modelos, permitindo lucro livre de risco (comprar todos os resultados por <$1,00). Mais comum, no entanto, é a arbitragem estatística, onde a soma das probabilidades reais calculadas pelo nosso modelo ($P_{real}$) para um subconjunto de contratos excede significativamente o custo de aquisição desses contratos ($P_{mercado}$), gerando Valor Esperado positivo (+EV).
2.2 Mecânica de Resolução e o "Ground Truth"
O componente mais crítico da estratégia, frequentemente ignorado por traders amadores, é a definição do oráculo de resolução. Um modelo meteorológico é inútil se prever a temperatura ambiente em um parque, enquanto o mercado liquida com base em um sensor situado em uma ilha de calor aeroportuária.
O padrão de mercado para resolução no Polymarket é a plataforma Wunderground (Weather Underground), que agrega dados METAR (Meteorological Aerodrome Report) de estações aeroportuárias oficiais. A precisão na identificação da estação correta é não-negociável.
2.2.1 Mapeamento Global de Estações de Resolução
A análise dos dados históricos e das regras de mercado permite construir a seguinte tabela de referência crítica para a modelagem:
Mercado (Cidade)	ID da Estação (ICAO)	Localização Real	Fator Crítico de Modelagem
New York City (NYC)	KLGA (LaGuardia)	Queens, Costa Norte	Frequentemente 2-4°F mais quente que o Central Park (KNYC) no verão devido à ilha de calor urbana e aquecimento da pista. Modelos globais focados em KNYC subestimarão a máxima. 
London	EGLC (London City)	Docklands, Urbano	Distinto de Heathrow (EGLL). EGLC é central e altamente sensível à retenção de calor urbano. 
Tokyo	RJTT (Haneda)	Baía de Tóquio	Localização costeira. Sujeito a brisas marítimas que podem limitar a máxima diurna abruptamente, diferindo do interior (e.g., estação Nerima ou RJAA Narita). 
Seoul	RKSI (Incheon)	Ilha de Yeongjong	Estação insular. A temperatura é significativamente moderada pelo oceano em comparação ao centro de Seul (que é mais continental). Modelos focados na cidade errarão a resolução do aeroporto. 
Sao Paulo	SBGR (Guarulhos)	Cumbica, Platô	Altitude ~750m. Sujeito a convecção rápida e resfriamento por tempestades de tarde. 
Ankara	LTAC (Esenboğa)	Norte da cidade	Clima de estepe/continental. Alta amplitude térmica diária. Resfriamento noturno radiativo intenso. 
Chicago	KORD (O'Hare)	Noroeste da cidade	Efeito de brisa do lago (Lake Michigan) pode causar quedas de temperatura drásticas em minutos, criando "caudas" de distribuição imprevisíveis para modelos de baixa resolução. 
Miami	KMIA (Miami Intl)	Interior (relativo)	Clima tropical marítimo. Menor variância, mas a resolução depende estritamente de evitar chuvas pontuais que resfriam o sensor. 
Seattle	KSEA (Tacoma)	Sul de Seattle	Zona de convergência de Puget Sound. 

Insight de Segunda Ordem: A maioria dos modelos meteorológicos de varejo (apps de celular) exibe uma média da cidade ou a estação central. O trader quantitativo ganha vantagem ("edge") simplesmente ao ajustar o modelo numérico para as coordenadas exatas e a altitude da estação ICAO de resolução (e.g., calibrar para KLGA, não "NYC").
2.2.2 A Matemática do Arredondamento e os "Ghost Bins"
A fonte de resolução (Wunderground/METAR) reporta frequentemente em números inteiros, mas a medição física é contínua. As regras de resolução introduzem descontinuidades matemáticas que devem ser exploradas.
    1. Regra de Arredondamento: Se a temperatura real for $32.50^\circ\text{F}$, a convenção padrão (arredondamento para o par ou para cima, dependendo da fonte) dita o resultado. Para o NWS/METAR, o padrão geralmente é arredondar aritmeticamente (.5 sobe).
        ◦ Um contrato "32°F" cobre o intervalo contínuo $

3. Modelagem Meteorológica Computacional: A Base do Sinal
Para estimar probabilidades melhor que o mercado, transformamos a previsão determinística em uma distribuição probabilística calibrada. O modelo não é $T = \mu$; o modelo é a função de densidade de probabilidade $f(t)$.
3.1 Sistemas de Previsão por Ensemble (EPS)
Utilizamos os dois principais sistemas globais, reconhecendo suas hierarquias de performance documentadas nos relatórios técnicos de 2024/2025 :
    1. ECMWF (European Centre for Medium-Range Weather Forecasts):
        ◦ IFS (Integrated Forecasting System): O "padrão ouro". Em 2024, a atualização do Ciclo 49r1 melhorou significativamente a assimilação de dados de temperatura a 2 metros (T2m).
        ◦ Ensemble (ENS): Composto por 51 membros (1 controle + 50 perturbados). A dispersão (spread) destes membros fornece a primeira estimativa da volatilidade atmosférica ($\sigma_{ENS}$).
        ◦ Métricas de Erro (2024): O RMSE (Root Mean Square Error) para T2m do ECMWF no horizonte de 1-3 dias é consistentemente inferior ao do GFS na extratrópica, embora a diferença tenha diminuído. A calibração estatística é essencial pois o ensemble cru tende a ser "sub-dispersivo" (confiante demais).
    2. GFS (Global Forecast System - NOAA/NCEP):
        ◦ GEFS (Global Ensemble): 31 membros.
        ◦ Características: Historicamente apresenta maior viés (bias) em T2m e maior variância. Útil como "segunda opinião" para detectar divergência de modelos. Se $| \mu_{ECMWF} - \mu_{GFS} | > \text{Limiar}$, a incerteza ($\sigma$) deve ser aumentada penalizando a confiança.
    3. Modelos de Inteligência Artificial (AIFS, GraphCast, Pangu):
        ◦ A partir de 2024/2025, modelos baseados em Machine Learning (como o AIFS do ECMWF) começaram a superar os modelos físicos (HRES) em métricas de superfície (T2m) para lead times curtos (1-3 dias).
        ◦ Estratégia: Incorporar o AIFS como um membro de alto peso no cálculo da média ponderada ($\mu$), especialmente em terrenos planos onde o AIFS demonstra redução de RMSE de até 15% em relação ao IFS clássico.
3.2 Transformação: Previsão $\to$ Distribuição Gaussiana
A temperatura $T$ é modelada como uma variável aleatória normal. Esta suposição é suportada pelo Teorema do Limite Central aplicado aos erros de previsão em sistemas caóticos.
$$T \sim \mathcal{N}(\mu_{calib}, \sigma_{total})$$
Onde:
    1. $\mu_{calib}$ (Média Calibrada): É a média do ensemble corrigida pelo viés histórico recente (Bias Correction).
       $$\mu_{calib} = \mu_{ENS} - \text{Bias}_{30d}$$
       $$\text{Bias}_{30d} = \frac{1}{30} \sum_{i=1}^{30} (Forecast_{t-i} - Observation_{t-i})$$
       Essa correção remove erros sistemáticos locais (e.g., o modelo GFS sempre subestima o calor urbano de LaGuardia).
    2. $\sigma_{total}$ (Desvio Padrão Total): A métrica de incerteza. Não basta usar o spread do ensemble, pois ele falha em capturar erros estruturais do modelo. Utilizamos uma calibração linear baseada no erro histórico (Método EMOS - Ensemble Model Output Statistics).
       $$\sigma_{total}^2 = a + b \cdot \sigma_{ENS}^2 + \text{RMSE}_{hist}^2$$
        ◦ Se o spread do modelo é baixo ($\sigma_{ENS} \approx 0$), a incerteza não é zero; ela é, no mínimo, o erro histórico do modelo (RMSE) para aquele horizonte de previsão.
        ◦ Para horizontes de 1-3 dias, o RMSE típico do ECMWF para T2m situa-se entre $1.5^\circ\text{C}$ e $2.5^\circ\text{C}$ dependendo da estação do ano e latitude.

4. Engenharia de Precificação e Detecção de Edge
Uma vez definidos $\mu_{calib}$ e $\sigma_{total}$, o problema de meteorologia torna-se um problema de cálculo integral.
4.1 Cálculo das Probabilidades de Intervalo
Para cada contrato oferecido no mercado (Ex: "32-33°F"), calculamos a probabilidade teórica $P_{real}$ integrando a PDF Gaussiana sobre o intervalo do contrato.
Se o contrato cobre o intervalo de temperatura $.

5. Otimização de Portfólio: Dutching e Critério de Kelly Generalizado
A inovação central desta estratégia é a gestão de múltiplos contratos. Não tentamos "acertar" o bin vencedor (ex: apenas comprar 32-33). Compramos uma faixa de bins (ex: 30-31, 32-33, 34-35) para cobrir a distribuição de probabilidade a um custo descontado. Isso é chamado de Dutching Probabilístico.
5.1 O Problema dos Eventos Mutuamente Exclusivos
Para eventos independentes, a fórmula de Kelly simples ($f = \frac{bp-q}{b}$) funciona. No entanto, os contratos de temperatura são mutuamente exclusivos: se a temperatura for 32°F, não pode ser 34°F. A compra de um contrato atua como hedge parcial contra a perda dos outros. A fórmula simples de Kelly falha matematicamente aqui, sugerindo alocações sub-ótimas ou excessivamente agressivas.
5.2 O Algoritmo de Kelly Generalizado (Gradient Ascent)
Para maximizar a taxa de crescimento logarítmico do capital em um conjunto de apostas mutuamente exclusivas, devemos resolver o seguinte problema de otimização convexa:
Maximizar $\mathbb{E}[\ln(X)]$:
$$\text{Max } \sum_{i=1}^{N} p_i \ln\left(1 - \sum_{j=1}^{N} f_j + f_i o_i\right)$$
Onde:
    • $p_i$: Probabilidade real calculada para o resultado $i$.
    • $o_i$: Odds decimais do mercado para o resultado $i$ ($1/P_{mercado}$).
    • $f_i$: Fração do capital alocada ao resultado $i$.
    • $\sum f_j$: Soma total do capital apostado (exposição total).
Como não há solução analítica fechada simples para $N > 2$ com restrições, utilizamos um algoritmo numérico de Gradient Ascent (Subida de Gradiente) para encontrar o vetor ótimo de alocações $\vec{f} = [f_1, f_2,..., f_n]$.
5.3 Implementação do Algoritmo (Pseudo-código Python)
A implementação computacional segue os passos detalhados na literatura financeira quantitativa :
    1. Inicialização: Definir todas as alocações $f_i = 0$.
    2. Cálculo do Gradiente: Para cada contrato $i$, calcular a derivada parcial da função de utilidade logarítmica:
       $$\frac{\partial \mathbb{E}}{\partial f_i} = \sum_{k=1}^{N} \frac{p_k \cdot (\delta_{ik} o_i - 1)}{1 - \sum f_j + f_k o_k}$$
       (Onde $\delta_{ik}$ é o delta de Kronecker: 1 se $i=k$, 0 caso contrário).
    3. Atualização dos Pesos: Ajustar as alocações na direção do gradiente:
       $$f_i^{novo} = f_i^{velho} + \alpha \times \text{Gradiente}_i$$
    4. Restrições: Aplicar restrição de não-alavancagem ($\sum f_i < 1$) e não-negatividade ($f_i \ge 0$).
    5. Iteração: Repetir até convergência (gradiente $\approx 0$).
5.4 Kelly Fracionado e Gestão de Capital
O critério de Kelly "Full" é matematicamente ótimo para crescimento a longo prazo, mas implica volatilidade extrema (risco de drawdown de 50%+).
    • Regra de Ouro: Utilizar Kelly Fracionado (ex: $f_{final} = 0.25 \times f_{otimo}$).
    • Isso reduz a variância dos retornos drasticamente enquanto preserva cerca de 75% da taxa de crescimento geométrica composta.
    • Limite de Exposição: Nunca alocar mais de 2% a 5% do capital total em um único evento meteorológico diário, pois os erros de modelo são correlacionados entre cidades (ex: uma frente fria afeta Chicago hoje e NYC amanhã).

6. Infraestrutura Operacional e Microestrutura
A execução da estratégia exige automação. O "bot" não é um preditor, é um motor de execução.
6.1 Integração de Dados (Pipeline ETL)
    1. Ingestão de Modelos: Download automático de arquivos GRIB2 do NOAA (GFS) e ECMWF (Open Data). Interpolação bi-linear para as coordenadas exatas das estações (KLGA, EGLC, etc.).
    2. Cálculo de Viés: Download de dados METAR das últimas 720 horas (30 dias). Cálculo do resíduo médio horário.
    3. Detecção de Divergência: Cálculo da Divergência de Jensen-Shannon (JSD) ou desvio padrão entre os membros do ensemble.
        ◦ Filtro de Divergência: Se a JSD entre as distribuições do ECMWF e GFS exceder um limiar (ex: 0.4), o mercado está em regime de alta incerteza/caos. A estratégia deve pausar ou focar exclusivamente nas caudas extremas (long volatility).
6.2 Dinâmica do Order Book (CLOB)
O Polymarket opera com um Central Limit Order Book. A liquidez não é infinita.
    • Slippage (Deslizamento): Ao executar o Dutching (comprar múltiplos contratos), o trader consome liquidez em vários levels do book. O cálculo do EV deve considerar o preço médio de execução, não apenas o best ask.
    • Estratégia de Maker: Em vez de agredir a mercado (taker), o algoritmo deve posicionar ordens limitadas (maker) nos preços calculados pelo Kelly, provendo liquidez e capturando o spread.
6.3 Arbitragem de Latência
As fontes de resolução (Wunderground) têm atraso em relação aos dados brutos da aviação (ADS-B / METAR).
    • Cenário: O METAR de KLGA às 14:53 reporta 45°F. O site do Wunderground ainda mostra 43°F (atualização anterior). O mercado pode não ter reagido.
    • Ação: Se 45°F já ocorreu fisicamente, a probabilidade do bin "44-45°F" (ou superior) é agora 100%. Comprar qualquer preço abaixo de 99 centavos é lucro livre de risco.

7. Roteiro de Implementação e Conclusão
A transição para um projeto quantitativo exige disciplina absoluta em relação aos dados e desprezo pela intuição meteorológica subjetiva. O trader não opina sobre o clima; ele audita a precificação do risco climático.
Checklist Diário do Market Maker:
    1. Atualização de Modelo (00z, 06z, 12z, 18z): Rodar pipeline Python para recalcular $\mu$ e $\sigma$ com os dados mais recentes do ECMWF/AIFS.
    2. Verificação de Estação: Confirmar se a regra do mercado (ID da estação) não mudou.
    3. Cálculo de $P_{real}$: Gerar a tabela de probabilidades para todos os bins.
    4. Detecção de Oportunidade: Identificar contratos onde $\text{Edge} > 10\%$.
    5. Otimização Kelly: Rodar o algoritmo de Gradient Ascent para determinar o tamanho do pacote de apostas (Dutching).
    6. Execução: Enviar ordens limitadas para o Polymarket via API.
    7. Gestão de Risco: Monitorar a exposição total e cancelar ordens se a divergência dos modelos aumentar subitamente.
Em suma, a estratégia transforma a incerteza meteorológica em uma classe de ativos estruturada. Ao operar consistentemente com EV positivo e gestão de capital Kelly, a Lei dos Grandes Números garante que a soma dos resultados convirja para o lucro, independentemente da aleatoriedade de um dia específico. Você não está apostando no tempo; você está sendo a seguradora do tempo.

Tabela Auxiliar: Desempenho Recente dos Modelos (RMSE T2m - 2024/25)
Dados compilados de relatórios técnicos recentes para calibração de $\sigma$.
Modelo	Horizonte (Dias)	Região	RMSE Típico (∘C)	Observação
ECMWF (IFS)	1-3	Extratrópicos	1.2 - 1.8	Padrão ouro, mas ligeiro viés frio em dias claros.
ECMWF (AIFS)	1-3	Extratrópicos	1.0 - 1.5	Superior ao IFS em terrenos planos. Menor erro quadrático.
GFS (NCEP)	1-3	América do Norte	1.5 - 2.2	Maior variância. Útil para capturar eventos extremos que o ECMWF suaviza.
Ensemble Mean	1-3	Global	1.1 - 1.6	A média do ensemble geralmente bate o determinístico no longo prazo (3+ dias).
Nota: Utilize o RMSE histórico local da estação alvo como o piso para o seu $\sigma$. Nunca assuma $\sigma < 1.0^\circ\text{F}$ independentemente da confiança do modelo.


